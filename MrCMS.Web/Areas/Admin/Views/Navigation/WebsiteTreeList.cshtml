@using MrCMS.Models
@model IList<MrCMS.Models.AdminTreeNode>
@{
    bool rootRequest = Model.First().ParentId == 0;
}

@if (rootRequest)
{
    <ul>
        <li class="jstree-open" id="0" data-can-add-child="True" data-sortable="True" data-haschildren="True">
            <a href="#">
                <i class="icon-asterisk">&nbsp;</i>Root</a>
            @RenderChildren(Model)
        </li>
    </ul>
}
else
{
    @RenderChildren(Model)
}

@helper RenderChildren(IList<AdminTreeNode> Model)
{
    <ul>
        @foreach (AdminTreeNode node in Model)
        {
            if (node.IsMoreLink)
            {
            <li><i class="icon-plus">&nbsp;</i>@Html.ActionLink(string.Format("{0} More", node.NumberMore), "Index", "Search", new { parent = node.ParentId }, null)</li>
            }
            else
            {
            <li id="@node.Id" data-id="@node.Id" data-parent-id="@node.ParentId" data-sortable="@node.Sortable" data-can-add-child="@node.CanAddChild" 
                data-haschildren="@node.HasChildren" data-controller="@node.NodeType" class="@(node.HasChildren ? "jstree-closed" : "")" data-jstree='{"icon":"@node.IconClass"}'>

                @{
                var cssClass = "";
                if (!node.RevealInNavigation)
                {
                    cssClass = "grey";
                }
                if (!node.IsPublished)
                {
                    cssClass = "orange";
                }
                }

                @(node.NodeType == "Webpage" ? Html.ActionLink(node.Name, "Edit", node.NodeType, new { id = node.Id }, new { @class = cssClass != "" ? cssClass : "" }) : Html.ActionLink(node.Name, "Edit", node.NodeType, new { id = node.Id }, null))
            </li>

            }
        }
    </ul>
}

